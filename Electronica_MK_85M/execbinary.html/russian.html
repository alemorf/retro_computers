<html lang="ru">
<head>
<meta charset="utf-8">
</head>
<body>
<h1>Запуск машинного кода</h1>

<p>Написано после обмозговывания этой статьи <a href="http://www.pisi.com.pl/piotr433/mk85mc1e.htm">http://www.pisi.com.pl/piotr433/mk85mc1e.htm</p></a>

<p>На Электронике МК-85 можно запустить свою программу в машинных кодах используя ошибку клавиши [AC]. 
Если во время выполнения команды INPUT нажать клавишу [AC], а затем клавишу [EXE], то интерпретатор Бейсика
сделает JMP на символ Бейсик программы следующий за выполнявшейся командой INPUT.</p>

<p>Чуть подробнее. Во время редактирования Бейсик программы нажатие на клавишу [EXE] приводит к запуску подпрограммы в машинных 
кодах по адресу сохраненному в слове памяти 8258h. Обычно в этом слове находится правильный адрес и нажатие 
на [EXE] ни к чему плохому не приводит. Но если прервать выполнение команды INPUT нажав кнопку [AC], то 
в ячейку 8258h адрес нужной функции не записывается. Во время выполнения программы эта ячейка используется
для хранения временных переменных. Функция INPUT там сохраняет адрес следующей команды Бейсик программы.</p>

<div class="h2">Первый пример</div>

<p>Традиционно, первая программа, которую пишет каждый программист, начиная изучать новое
железо или новый язык программирования – это программа, выводящая на экран текст “Hello World”.</p>

<p>Вот пример такой программы. Программа написана начиная с адреса 826Bh, потому что это 
это адрес программы P0 в памяти компьютера. Эту программу надо вводить как программу P0,
как обычную программу на Бейсике. Первая проблема написания программы в машинных кодах в том, 
что не все нужные символы можно ввести с клавиатуры. Вторая проблема в том, что получившаяся каша 
должна быть похожа на Бейсик программу, что бы компьютер сохранил её в своей памяти.</p>

<blockquote style="font-family:courier,mono;white-space:pre"
><i>Адрес Данные                                      Для ввода      Ассемблер</i>
826B  01 00 DF 31 31 31 31                        <font color=blue>1 INPUT</font> 1111
8272  21 81                                       !<font color=red>а</font>             bmi 82B6
8274  не имеет значения
8296  1F 09 B0 82                                 <font color=blue>2335</font><font color=red>Пб</font>         jsr  r4, @#82B0
829A  48 45 4C 4C 4F 3D 57 4F 52 4C 44 21 3D 00   HELLO=WORLD!=<font color=violet>0</font>
82A8  5F 09 AE 82                                 <font color=blue>2399</font><font color=red>Нб</font>         jsr  r5, @#82AE
82AC  0C 7E                                       <font color=green>∑</font>≥             sob  r0, 8296
82AE  85 00                                       <font color=red>е</font><font color=violet>0</font>             rts  r5
82B0  DF 09 48 12                                 <font color=blue>2527</font><font color=red>Н</font>♣         jsr  pc, @#1248 ; Вывод символа
82B4  84 00                                       <font color=red>д</font><font color=violet>0</font>             rts  r4
82B6  DF 15 41 80 64 82                           <font color=blue>5599</font>A<font color=red>ю</font>d<font color=red>б</font>       mov  #8041, @#8264
82BC  14 7E                                       <font color=green>♦</font>≥             sob  r0, 8296
</blockquote>

<p>Вот что потребуется набрать на клавиатуре:</p>

<blockquote><img src="execbinary1.png" width="256" height="188" alt="first machine code program"></blockquote>

<p>Символы вводимые в английской раскладке клавиатуры обозначены <font color="#000000"><b>черным цветом</b></font>, в русской раскладке обозначены <font color="#C80000"><b>красным цветом</b></font>,
графические символы обозначены <font color="#008000"><b>зеленым цветом</b></font>,
команды Бейска обозначены <font color="#0000C0"><b>синим цветом</b></font>.
Будьте предельно внимательны при вводе, некоторые русские и английские буквы 
неразличимы на экране компьютера, но имеют разные коды.

<p>Для запуска программы введите RUN. Когда команда INPUT предложит ввести значение с клавиатуры,
нажмите [AC]. После того как дисплей очистится и снова появится курсор, нажмите [EXE]. Запустится 
введенная программа. На экране будет выводиться прокручивающийся текст "HELLO=WORLD!=". 
Остановить программу можно нажав клавишу [STOP], а затем [AC].</p>

<p>Шестнадцатеричный дамп оперативной памяти компютера после ввода этой программы:</p>

<blockquote style="font-family:courier,mono;white-space:pre"
>0260                                      01   00 df 31 31  ..............11
0270  31 31 21 81   00 02 00 21  30 31 32 33   34 35 36 37  11!....!01234567
0280  38 39 30 31   32 00 03 00  21 30 31 32   33 34 35 36  89012...!0123456
0290  37 38 39 30   31 00 1f 09  b0 82 48 45   4c 4c 4f 3d  78901.....HELLO=
02a0  57 4f 52 4c   44 21 3d 00  5f 09 ae 82   0c 7e 85 00  WORLD!=._....~..
02b0  df 09 48 12   84 00 df 15  41 80 64 82   14 7e 00     ..H.....A.d..~..
</blockquote>

<p>Запущено на реальном компьютере:</p>

<img style="max-width:100%" src="execbinary2.jpg">

</body>
</html>
