all: micro80bios.js micro80font.js micro80cpm.js filelist.js

format:
	clang-format -i *.js

micro80bios.js: micro80.bin Makefile
	echo "// clang-format off" >micro80bios.js
	echo "// autogenerated" >>micro80bios.js
	echo "const bios = [" >>micro80bios.js
	xxd -i micro80.bin | grep , >>micro80bios.js
	echo "];" >>micro80bios.js

micro80cpm.js: micro80cpm.bin Makefile
	echo "// clang-format off" >micro80cpm.js
	echo "// autogenerated" >>micro80cpm.js
	echo "const cpmBios = [" >>micro80cpm.js
	xxd -i micro80cpm.bin | grep , >>micro80cpm.js
	echo "];" >>micro80cpm.js

micro80font.js: font.bin Makefile
	echo "// clang-format off" >micro80font.js
	echo "// autogenerated" >>micro80font.js
	echo "const font = [" >>micro80font.js
	xxd -i font.bin | grep , >>micro80font.js
	echo "];" >>micro80font.js

files/%.rk.js: files/%.rk
	echo "// clang-format off" >$@
	echo "// autogenerated from $^" >>$@
	echo "loadFile([" >>$@
	xxd -i $< | grep , >>$@
	echo "]);" >>$@

filelist.js: $(addsuffix .js,$(wildcard files/*.rk))
	echo "// clang-format off" >filelist.js
	echo "// autogenerated" >filelist.js
	echo "const fileList = [" >>filelist.js
	for i in files/*.rk; \
	do \
	echo "  '$$i'," >>filelist.js; \
	done
	echo "];" >>filelist.js
