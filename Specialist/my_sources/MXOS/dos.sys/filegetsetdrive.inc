;+---------------------------------------------------------------------------
; MXOS
; Получение/изменение текущего накопителя
;
; На входе 
;   e  - 0=чтение, 1=изменение
;   a  - накопитель от 0 до 7
;
; На выходе 
;   a  - накопитель
;   bc,de,hl - сохраняются
;
; 2013-12-12 Дизассемблировано vinxru
;----------------------------------------------------------------------------

fileGetSetDrive:
		dcr	e
		jz	fileSelectDrive
		lda	v_drive
		ret

; ---------------------------------------------------------------------------

fileSelectDrive:; Максимум устройств
		ani	7

		; Сохраняем выбранное устройство
		sta	v_drive

		; Пригодится ниже (a = a * 2)
		add	a

		; Сохраняем регистры
		push	h
		push	d

		; Получаем точку входа драйвера
		mov	l, a
		mvi	h, 0
		lxi	d, v_drives
		dad	d
		mov	e, m
		inx	h
		mov	d, m
		xchg

		; Сохраняем её
		shld	j_diskDriver+1

		; Восстаналвиаем A
		rrc

.include "driver_sel.inc"

		; Восстанавливаем регистры и выходим
		pop	d
		pop	h
		ret
