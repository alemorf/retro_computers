;+---------------------------------------------------------------------------
; MXOS
; Обработка служебных кодов при выводе символа (продолжение)
; Расчет адреса символа в знакогенераторе и адреса вывода на экран
;
; 2013-12-12 Дизассемблировано vinxru
;----------------------------------------------------------------------------

; ---------------------------------------------------------------------------
; Обработка ESC+(. Выключение KOI-7

printChar_e28:	mvi	a, 0FFh
		sta	v_koi8
		ret

; ---------------------------------------------------------------------------
; Обработка ESC+). Включение KOI-7

printChar_e29:	xra	a
		sta	v_koi8
		ret

; ---------------------------------------------------------------------------
; Обработка кода 9. Табуляция

printChar_c9:	lda	v_cursorX	
		adi	24
		sta	v_cursorX
		ret

; ---------------------------------------------------------------------------
; Вывод символа С из знакогенартора по адресу HL*8 на экран в положение 
; курсора. Курсор при этом перемещается 

printChar_alt:	; de = (hl+c)*8
		mvi	b, 0
		dad	b
		dad	h
		dad	h
		dad	h
		xchg

		; Продолжение в printChar_de

; ---------------------------------------------------------------------------
; Вывод символа DE на экран в положение курсора. Курсор при этом перемещается 
; вправо.

printChar_de:	; Рассчитываем адрес вывода (hl=v_cursorPos, a*256+l=адрес)
		call	calcCursorAddr

		; Перемещаем курсор вправо
		inr	h
		inr	h
		inr	h		
		shld	v_cursorY

		; Корректируем адрес вывода (bc = al - 7)
		mov	b, a
		mov	a, l
		sui	7
		mov	c, a

		; Продолжение в drawChar